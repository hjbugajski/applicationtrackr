<div class="column-header at-text" [ngClass]="column?.color">
  <div class="column-title-container">
    <span class="column-title">{{ column?.title }}</span>
    <at-tag *ngIf="column && !(column?.total === 0 && (collapseColumns$ | async))" size="small" [color]="column.color">
      {{ column.total }}
    </at-tag>
  </div>
  <div class="column-actions">
    <button mat-icon-button [color]="column?.color" (click)="newApplication()" [disabled]="!column">
      <mat-icon>add</mat-icon>
    </button>
    <button mat-icon-button [color]="column?.color" [matMenuTriggerFor]="columOptionsMenu" [disabled]="!column">
      <mat-icon>more_horiz</mat-icon>
    </button>

    <mat-menu #columOptionsMenu="matMenu" xPosition="before">
      <button mat-menu-item (click)="editColumn()">Edit</button>
      <button mat-menu-item (click)="reorderColumn()">Reorder</button>
      <button mat-menu-item [matMenuTriggerFor]="sortApplicationsMenu" class="mat-menu-item-with-right-icon">
        Sort
        <mat-icon>arrow_right</mat-icon>
      </button>
      <button mat-menu-item class="at-text danger" (click)="deleteColumn()">Delete</button>
    </mat-menu>

    <mat-menu #sortApplicationsMenu="matMenu">
      <ng-container *ngFor="let sortOption of sortOptions; let i = index">
        <button
          mat-menu-item
          [class.mat-list-single-selected-option]="sortOption === selectedSortOption"
          (click)="sort(sortOption)"
        >
          {{ sortOption.viewValue }}
        </button>
        <mat-divider *ngIf="i % 2 !== 0 && i + 1 !== sortOptions.length"></mat-divider>
      </ng-container>
    </mat-menu>
  </div>
</div>
<cdk-virtual-scroll-viewport
  cdkDropList
  cdkDropListSortingDisabled
  [cdkDropListDisabled]="isTouch"
  [cdkDropListData]="column"
  (cdkDropListDropped)="drop($event)"
  itemSize="25"
  class="cdk-container"
>
  <div
    *cdkVirtualFor="let application of applications$ | async"
    cdkDrag
    [cdkDragData]="application"
    class="at-application-card-container"
  >
    <a
      *ngIf="application.link"
      mat-icon-button
      [href]="application.link"
      rel="noreferrer"
      target="_blank"
      class="at-application-card-link-button"
    >
      <mat-icon>open_in_new</mat-icon>
    </a>
    <at-application-card [application]="application" [column]="column!">
      <div class="drag-drop-placeholder" *cdkDragPlaceholder></div>
    </at-application-card>
  </div>
</cdk-virtual-scroll-viewport>
